<style>
/* 桌面端：正文左 + TOC右 */
@media (min-width: 67rem) {
  .main-content-wrap {
    display: flex !important;
    align-items: flex-start !important;
    gap: 32px;
  }
  .main-content {
    flex: 1 1 auto;
    min-width: 0;
  }
  #page-toc.page-toc {
    flex: 0 0 260px;
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 140px);
    overflow: auto;
    border-left: 1px solid rgba(255,255,255,0.10);
    padding-left: 16px;
  }
  #page-toc .page-toc-title {
    font-size: 0.85rem;
    color: #9bb0c5;
    margin-bottom: 10px;
  }
  /* 右侧 TOC 链接 */
  #page-toc a { color: #b8c4d1 !important; text-decoration: none; }
  #page-toc a:hover { color: #76b900 !important; }
}

/* 小屏隐藏 TOC */
@media (max-width: 66.99rem) {
  #page-toc { display: none; }
}
</style>

<script>
/* 每页自动生成右侧 TOC（抓 h2/h3） */
document.addEventListener('DOMContentLoaded', function () {
  const main = document.querySelector('.main-content');
  const wrap = document.querySelector('.main-content-wrap');
  if (!main || !wrap) return;

  // 已存在就不重复生成
  if (document.getElementById('page-toc')) return;

  const headings = Array.from(main.querySelectorAll('h2, h3'));
  if (headings.length === 0) return;

  const slugify = (s) => (s || '').trim().toLowerCase()
    .replace(/[\s]+/g, '-')
    .replace(/[^\w\-]+/g, '')
    .replace(/\-+/g, '-');

  const used = new Set();

  const tocBox = document.createElement('aside');
  tocBox.id = 'page-toc';
  tocBox.className = 'page-toc';
  tocBox.innerHTML = '<div class="page-toc-title">On this page</div><ul class="page-toc-list"></ul>';

  const list = tocBox.querySelector('.page-toc-list');

  headings.forEach(h => {
    // 给没有 id 的标题自动补 id
    if (!h.id) {
      const base = slugify(h.textContent) || 'section';
      let id = base, i = 2;
      while (used.has(id) || document.getElementById(id)) id = `${base}-${i++}`;
      h.id = id;
      used.add(id);
    }

    const li = document.createElement('li');
    li.style.margin = '8px 0';
    if (h.tagName.toLowerCase() === 'h3') li.style.marginLeft = '10px';

    const a = document.createElement('a');
    a.href = `#${h.id}`;
    a.textContent = h.textContent;

    li.appendChild(a);
    list.appendChild(li);
  });

  wrap.appendChild(tocBox);
});
</script>
